<div align="center">

<!-- Animated Header -->
<img src="https://capsule-render.vercel.app/api?type=waving&color=0:FF6B6B,50:FFA94D,100:FFD43B&height=220&section=header&text=ğŸ›%20KANGAL&fontSize=80&fontColor=ffffff&animation=fadeIn&fontAlignY=35&desc=à¦®à§‡à¦¸%20à¦®à§à¦¯à¦¾à¦¨à§‡à¦œà¦®à§‡à¦¨à§à¦Ÿ,%20à¦•à¦¿à¦¨à§à¦¤à§%20à¦à¦¾à¦®à§‡à¦²à¦¾%20à¦›à¦¾à¦¡à¦¼à¦¾à¥¤&descSize=18&descAlignY=55" width="100%" />

<!-- Typing SVG -->
<a href="https://kangal.software">
  <img src="https://readme-typing-svg.demolab.com?font=Fira+Code&weight=600&size=22&duration=3000&pause=1000&color=FF6B6B&center=true&vCenter=true&multiline=true&repeat=true&random=false&width=600&height=80&lines=Meal+tracking+with+one+tap+ğŸ½ï¸;Auto-calculated+meal+rates+ğŸ“Š;Zero+more+%22manager+tumi+taka+marcho%22+ğŸ¤«" alt="Typing SVG" />
</a>

<br/>

<!-- Badges -->
[![Live Demo](https://img.shields.io/badge/ğŸŒ_Live-kangal.software-FF6B6B?style=for-the-badge&labelColor=1a1a2e)](https://kangal.software)
[![Next.js](https://img.shields.io/badge/Next.js_16-000?style=for-the-badge&logo=next.js&logoColor=white)](https://nextjs.org)
[![Supabase](https://img.shields.io/badge/Supabase-3FCF8E?style=for-the-badge&logo=supabase&logoColor=white)](https://supabase.com)
[![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white)](https://typescriptlang.org)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind_v4-06B6D4?style=for-the-badge&logo=tailwindcss&logoColor=white)](https://tailwindcss.com)
[![React](https://img.shields.io/badge/React_19-61DAFB?style=for-the-badge&logo=react&logoColor=black)](https://react.dev)

<br/>

<!-- GitHub Stats Badges -->
![GitHub stars](https://img.shields.io/github/stars/sovon1/kangal-app?style=social)
![GitHub forks](https://img.shields.io/github/forks/sovon1/kangal-app?style=social)
![GitHub issues](https://img.shields.io/github/issues/sovon1/kangal-app?color=FF6B6B)
![License](https://img.shields.io/badge/license-MIT-FFA94D)

</div>

---

## ğŸ’¡ The Problem

> Every university mess in Bangladesh runs on **WhatsApp groups**, **paper khatas**, and **mental math**. Managers get accused of stealing money, members forget which meals they ate, and month-end calculations take hours with a calculator.

<div align="center">

```
     ğŸ“± WhatsApp Groups          ğŸ““ Paper Khatas           ğŸ§® Mental Math
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     "à¦­à¦¾à¦‡ à¦†à¦œà¦•à§‡ à¦–à¦¾à¦¬à§‹ à¦¨à¦¾"        *à¦¹à¦¾à¦°à¦¿à¦¯à¦¼à§‡ à¦—à§‡à¦›à§‡*            "à¦®à¦¨à§‡ à¦¨à¦¾à¦‡ à¦­à¦¾à¦‡"
     "à¦•à§‡ à¦¬à¦¾à¦œà¦¾à¦° à¦•à¦°à¦¬à§‡?"           *à¦­à§à¦² à¦¹à¦¿à¦¸à¦¾à¦¬*              "à¦¤à§‹à¦®à¦¾à¦° à§«à§¦ à¦Ÿà¦¾à¦•à¦¾ à¦¬à¦¾à¦•à¦¿"
     "à¦®à§à¦¯à¦¾à¦¨à§‡à¦œà¦¾à¦° à¦Ÿà¦¾à¦•à¦¾ à¦®à¦¾à¦°à¦›à§‡!"    *à¦›à§‡à¦à¦¡à¦¼à¦¾ à¦ªà§‡à¦œ*             "à¦†à¦®à¦¿ à§¨ à¦¬à§‡à¦²à¦¾à¦‡ à¦–à¦¾à¦‡à¦¨à¦¿!"
```

</div>

### âœ… KANGAL fixes all of this. Permanently.

---

## âœ¨ Features at a Glance

<div align="center">

| | Feature | What it does | Vibe |
|---|---------|-------------|------|
| ğŸ½ï¸ | **Meal Tracking** | Toggle breakfast/lunch/dinner with one tap | *"à¦†à¦œà¦•à§‡ à¦²à¦¾à¦à§à¦š à¦…à¦«"* |
| ğŸ›’ | **Bazaar Logs** | Record every shopping trip item-by-item | *"à¦†à¦œ à¦ªà§‡à¦à¦¯à¦¼à¦¾à¦œ à§§ à¦•à§‡à¦œà¦¿, à§ªà§¦ à¦Ÿà¦¾à¦•à¦¾"* |
| ğŸ“Š | **Auto Meal Rate** | `Total Bazaar Ã· Total Meals = Rate` â€” live | *"à¦†à¦œà¦•à§‡à¦° à¦°à§‡à¦Ÿ à§©à§®.à§«à§¦"* |
| ğŸ’° | **Deposits** | Track every taka deposited, with approval | *"à§§à§«à§¦à§¦ à¦¬à¦¿à¦•à¦¾à¦¶à§‡ à¦¦à¦¿à¦²à¦¾à¦®"* |
| ğŸ“„ | **PDF Reports** | One-click export for any member or full mess | *"à¦à¦‡ à¦¨à¦¾à¦“ PDF"* |
| ğŸ“ˆ | **Spending Charts** | Visualize who ate how much with bar charts | *"à¦¸à¦¬à¦šà§‡à¦¯à¦¼à§‡ à¦¬à§‡à¦¶à¦¿ à¦¤à§à¦®à¦¿ à¦–à¦¾à¦“ à¦­à¦¾à¦‡"* |
| ğŸ‘¥ | **Manager Tools** | Month closing, member management, role transfer | *"à¦¨à¦¤à§à¦¨ à¦®à§à¦¯à¦¾à¦¨à§‡à¦œà¦¾à¦° à¦¨à¦¿à¦¯à§à¦•à§à¦¤"* |
| â° | **Cutoff Locking** | Auto-lock meals after configurable cutoff times | *"à¦°à¦¾à¦¤ à§¯à¦Ÿà¦¾à¦° à¦ªà¦° à¦¬à¦¨à§à¦§"* |
| ğŸ” | **Full Auth** | Email/password + Google OAuth + password reset | *"à¦­à§à¦²à§‡ à¦—à§‡à¦›à¦¿? Reset!"* |
| ğŸ“± | **PWA Ready** | Install on home screen, works like native app | *"à¦…à§à¦¯à¦¾à¦ª à¦à¦° à¦®à¦¤à§‹à¦‡!"* |

</div>

---

## ğŸ—ï¸ System Architecture

```mermaid
graph TB
    subgraph Client ["ğŸ–¥ï¸ Client Layer"]
        A["âš›ï¸ React 19 + Next.js 16<br/><i>App Router + Turbopack</i>"]
        B["ğŸ¨ Tailwind CSS v4 + shadcn/ui"]
        C["ğŸ“Š Recharts + jsPDF"]
    end

    subgraph Server ["âš™ï¸ Server Layer"]
        D["ğŸ”„ Server Actions<br/><i>Type-safe RPC</i>"]
        E["ğŸ›¡ï¸ Auth Middleware<br/><i>Protected Routes</i>"]
        F["ğŸ—‚ï¸ React Query<br/><i>Smart Caching</i>"]
    end

    subgraph Database ["ğŸ—„ï¸ Supabase (PostgreSQL)"]
        G["ğŸ“‹ 14 Tables<br/><i>3NF Normalized</i>"]
        H["ğŸ”’ Row Level Security<br/><i>Per-mess isolation</i>"]
        I["âš¡ Triggers & RPCs<br/><i>Atomic operations</i>"]
    end

    A --> D
    B --> A
    C --> A
    D --> E
    E --> G
    F --> D
    G --> H
    G --> I

    style Client fill:#1a1a2e,stroke:#FF6B6B,color:#fff
    style Server fill:#16213e,stroke:#FFA94D,color:#fff
    style Database fill:#0f3460,stroke:#3FCF8E,color:#fff
```

---

## ğŸ—„ï¸ Database Schema

<details>
<summary><b>ğŸ“ Click to expand Entity Relationship Diagram</b></summary>

<br/>

```mermaid
erDiagram
    profiles ||--o{ mess_members : "has membership"
    profiles ||--o{ messes : "creates"
    messes ||--o{ mess_members : "has"
    messes ||--o{ mess_cycles : "has"
    messes ||--o{ bazaar_expenses : "has"
    messes ||--o{ fixed_costs : "has"
    messes ||--o{ individual_costs : "has"
    messes ||--o{ inventory : "tracks"
    messes ||--o{ meal_cutoff_config : "configures"
    messes ||--o{ activity_log : "logs"
    messes ||--o{ announcements : "posts"
    mess_cycles ||--o{ daily_meals : "contains"
    mess_cycles ||--o{ transactions : "records"
    mess_cycles ||--o{ bazaar_expenses : "tracks"
    mess_cycles ||--o{ fixed_costs : "includes"
    mess_cycles ||--o{ individual_costs : "includes"
    mess_cycles ||--o{ month_snapshots : "archives"
    mess_members ||--o{ daily_meals : "logs"
    mess_members ||--o{ transactions : "makes"
    mess_members ||--o{ individual_costs : "incurs"
    bazaar_expenses ||--o{ bazaar_items : "contains"

    profiles {
        uuid id PK
        text full_name
        text email
        text phone
        text avatar_url
    }

    messes {
        uuid id PK
        text name
        text address
        uuid created_by FK
        text invite_code
        int max_members
    }

    mess_members {
        uuid id PK
        uuid mess_id FK
        uuid user_id FK
        user_role role
        user_status status
        date join_date
        date leave_date
    }

    mess_cycles {
        uuid id PK
        uuid mess_id FK
        text name
        date start_date
        date end_date
        cycle_status status
        numeric final_meal_rate
    }

    daily_meals {
        uuid id PK
        uuid mess_id FK
        uuid cycle_id FK
        uuid member_id FK
        date meal_date
        boolean breakfast
        boolean lunch
        boolean dinner
        int guest_breakfast
        int guest_lunch
        int guest_dinner
    }

    transactions {
        uuid id PK
        uuid mess_id FK
        uuid cycle_id FK
        uuid member_id FK
        numeric amount
        payment_method method
        text reference_no
    }

    bazaar_expenses {
        uuid id PK
        uuid mess_id FK
        uuid cycle_id FK
        uuid shopper_id FK
        date expense_date
        numeric total_amount
    }

    bazaar_items {
        uuid id PK
        uuid expense_id FK
        text item_name
        numeric quantity
        text unit
        numeric unit_price
        numeric total_price
    }

    fixed_costs {
        uuid id PK
        uuid mess_id FK
        uuid cycle_id FK
        fixed_cost_type cost_type
        numeric amount
    }

    individual_costs {
        uuid id PK
        uuid mess_id FK
        uuid cycle_id FK
        uuid member_id FK
        text description
        numeric amount
        approval_status status
    }

    inventory {
        uuid id PK
        uuid mess_id FK
        text item_name
        numeric current_qty
        text unit
    }

    month_snapshots {
        uuid id PK
        uuid cycle_id FK
        uuid member_id FK
        int total_meals
        numeric meal_rate
        numeric closing_balance
    }

    meal_cutoff_config {
        uuid id PK
        uuid mess_id FK
        time breakfast_cutoff
        time lunch_cutoff
        time dinner_cutoff
    }

    activity_log {
        uuid id PK
        uuid mess_id FK
        uuid actor_id FK
        text action
        jsonb details
    }

    announcements {
        uuid id PK
        uuid mess_id FK
        text title
        text content
        text priority
    }
```

</details>

---

## ğŸ’¸ The Balance Formula

```mermaid
graph LR
    A["ğŸ’µ Opening Balance<br/><i>from previous month</i>"] --> E
    B["â• Deposits<br/><i>cash, bKash, Nagad</i>"] --> E
    E["ğŸ“Š Credits"] --> F

    C1["ğŸ½ï¸ Meals Ã— Rate"] --> G
    C2["ğŸ  Prorated Fixed Costs<br/><i>rent, gas, wifi...</i>"] --> G
    C3["ğŸ‘¤ Individual Costs"] --> G
    G["ğŸ“‰ Debits"] --> F

    F["ğŸ’° Current Balance<br/><i>=  Credits - Debits</i>"]

    style A fill:#22c55e,stroke:#16a34a,color:#fff
    style B fill:#22c55e,stroke:#16a34a,color:#fff
    style E fill:#3b82f6,stroke:#2563eb,color:#fff
    style C1 fill:#ef4444,stroke:#dc2626,color:#fff
    style C2 fill:#ef4444,stroke:#dc2626,color:#fff
    style C3 fill:#ef4444,stroke:#dc2626,color:#fff
    style G fill:#f97316,stroke:#ea580c,color:#fff
    style F fill:#8b5cf6,stroke:#7c3aed,color:#fff
```

```
Balance = (Opening + Deposits) âˆ’ (Meals Ã— Rate + Fixed Costs + Individual Costs)
```

---

## âš¡ Month Close Flow

```mermaid
sequenceDiagram
    participant M as ğŸ‘¤ Manager
    participant S as âš™ï¸ Server Action
    participant DB as ğŸ—„ï¸ PostgreSQL

    M->>S: Click "Close Month"
    S->>DB: BEGIN TRANSACTION
    
    Note over DB: ğŸ”’ Lock cycle row (FOR UPDATE)
    
    DB->>DB: Calculate final meal rate
    DB->>DB: Snapshot every member's balance
    DB->>DB: Archive current cycle â†’ 'closed'
    DB->>DB: Create next month's cycle
    DB->>DB: Log activity
    
    DB->>S: COMMIT â†’ Return new_cycle_id
    S->>M: âœ… "Month closed successfully!"
    
    Note over M,DB: ğŸ‰ All atomic â€” if anything<br/>fails, everything rolls back!
```

---

## ğŸ› ï¸ Tech Stack

<div align="center">

| Layer | Technology | Why |
|-------|-----------|-----|
| âš›ï¸ **Frontend** | Next.js 16 + React 19 | App Router, Server Actions, Turbopack |
| ğŸ¨ **Styling** | Tailwind CSS v4 + shadcn/ui | Beautiful, consistent, accessible |
| ğŸ—„ï¸ **Database** | Supabase (PostgreSQL) | RLS, Triggers, RPCs, Realtime |
| ğŸ” **Auth** | Supabase Auth | Email/Password + Google OAuth |
| ğŸ“Š **Charts** | Recharts | Interactive, responsive visualizations |
| ğŸ“„ **PDF** | jsPDF + AutoTable | Generate reports client-side |
| ğŸ“¦ **State** | React Query (TanStack) | Smart caching, auto-refetch |
| âœ… **Validation** | Zod | Runtime type safety |
| ğŸš€ **Deploy** | Vercel | Zero-config, edge-optimized |
| ğŸ“± **PWA** | Web Manifest | Installable, native-like |

</div>

---

## ğŸ“ Project Structure

```
kangal-app/
â”œâ”€â”€ ğŸŒ public/
â”‚   â”œâ”€â”€ manifest.json              # PWA configuration
â”‚   â””â”€â”€ icons/                     # App icons (192Ã—192, 512Ã—512)
â”‚
â”œâ”€â”€ ğŸ“¦ src/
â”‚   â”œâ”€â”€ ğŸ—‚ï¸ app/
â”‚   â”‚   â”œâ”€â”€ (auth)/                # ğŸ”‘ Login, Signup, Forgot Password
â”‚   â”‚   â”œâ”€â”€ auth/callback/         # ğŸ”„ OAuth callback handler
â”‚   â”‚   â”œâ”€â”€ dashboard/             # ğŸ“Š Main app
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx           # ğŸ  Dashboard overview
â”‚   â”‚   â”‚   â”œâ”€â”€ meals/             # ğŸ½ï¸ Meal toggles + chart + manage
â”‚   â”‚   â”‚   â”œâ”€â”€ bazaar/            # ğŸ›’ Bazaar expense logs
â”‚   â”‚   â”‚   â”œâ”€â”€ deposits/          # ğŸ’° Deposit management
â”‚   â”‚   â”‚   â”œâ”€â”€ options/           # âš™ï¸ Cycle & mess settings
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/          # ğŸ‘¤ User profile settings
â”‚   â”‚   â”‚   â””â”€â”€ admin/             # ğŸ‘‘ Manager-only
â”‚   â”‚   â”‚       â”œâ”€â”€ costs/         # ğŸ’¸ Fixed & individual costs
â”‚   â”‚   â”‚       â”œâ”€â”€ members/       # ğŸ‘¥ Member management
â”‚   â”‚   â”‚       â””â”€â”€ month-close/   # ğŸ“‹ Monthly settlement
â”‚   â”‚   â””â”€â”€ page.tsx               # ğŸ  Landing page (marketing)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ§© components/
â”‚   â”‚   â”œâ”€â”€ dashboard/             # Stats cards, charts, meal toggles
â”‚   â”‚   â”œâ”€â”€ landing/               # Animated hero, feature cards
â”‚   â”‚   â”œâ”€â”€ mess-context.tsx       # ğŸ”— Shared context (perf optimization)
â”‚   â”‚   â””â”€â”€ ui/                    # shadcn/ui primitives
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“š lib/
â”‚   â”‚   â”œâ”€â”€ actions/               # Server actions (meals, bazaar, finance)
â”‚   â”‚   â”œâ”€â”€ supabase/              # Client & middleware setup
â”‚   â”‚   â”œâ”€â”€ pdf-export.ts          # PDF generation logic
â”‚   â”‚   â””â”€â”€ validations.ts         # Zod schemas
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ types/                  # TypeScript type definitions
â”‚
â””â”€â”€ ğŸ—„ï¸ supabase/
    â”œâ”€â”€ schema.sql                 # Complete DB schema (14 tables, RLS, triggers)
    â”œâ”€â”€ migration_fixes.sql        # Post-deploy fixes
    â””â”€â”€ migration_approval_system.sql  # Approval workflow
```

---

## ğŸ”’ Security Model

```mermaid
graph TD
    subgraph Auth ["ğŸ” Authentication"]
        A1["Supabase Auth<br/><i>JWT Tokens</i>"]
        A2["Next.js Middleware<br/><i>Route Protection</i>"]
    end

    subgraph RLS ["ğŸ›¡ï¸ Row Level Security"]
        R1["is_mess_member()"]
        R2["is_mess_manager()"]
    end

    subgraph Policies ["ğŸ“œ Access Policies"]
        P1["Members â†’ own mess data only"]
        P2["Managers â†’ full CRUD"]
        P3["Cross-mess â†’ impossible"]
    end

    A1 --> A2
    A2 --> R1
    A2 --> R2
    R1 --> P1
    R2 --> P2
    R1 --> P3

    style Auth fill:#1a1a2e,stroke:#FF6B6B,color:#fff
    style RLS fill:#16213e,stroke:#FFA94D,color:#fff
    style Policies fill:#0f3460,stroke:#3FCF8E,color:#fff
```

- **Every table** has RLS enabled â€” no data leaks between messes
- **Server-side auth** via Supabase SSR middleware
- **No secrets in client** â€” all sensitive operations are Server Actions
- **Atomic transactions** â€” month closing uses `SECURITY DEFINER` RPCs

---

## ğŸš€ Getting Started

### Prerequisites

- **Node.js 18+** and **npm**
- A [Supabase](https://supabase.com) project (free tier works!)

### Quick Setup

```bash
# 1ï¸âƒ£ Clone the repo
git clone https://github.com/sovon1/kangal-app.git
cd kangal-app

# 2ï¸âƒ£ Install dependencies
npm install

# 3ï¸âƒ£ Set up environment variables
cp .env.local.example .env.local
# Edit .env.local with your Supabase URL and anon key

# 4ï¸âƒ£ Set up the database
# Copy supabase/schema.sql â†’ Supabase SQL Editor â†’ Run

# 5ï¸âƒ£ Start the dev server
npm run dev
```

Open **[http://localhost:3000](http://localhost:3000)** and you're live! ğŸ‰

### Environment Variables

| Variable | Description |
|----------|-------------|
| `NEXT_PUBLIC_SUPABASE_URL` | Your Supabase project URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Your Supabase anonymous key |

---

## ğŸ“± Install as App (PWA)

<div align="center">

```
ğŸ“± Open kangal.software on your phone
     â†“
ğŸ“¥ Tap "Add to Home Screen"
     â†“
ğŸš€ Done! Works like a native app!
```

</div>

---

## ğŸ§® Database Stored Procedures

| Function | Purpose |
|----------|---------|
| `calculate_meal_rate(cycle_id)` | `Î£ Bazaar Ã· Î£ Meals` â€” the core formula |
| `prorate_fixed_costs(member_id, cycle_id)` | Fair share based on days present |
| `calculate_member_balance(member_id, cycle_id)` | Full financial breakdown |
| `close_mess_month(cycle_id)` | Atomic month close (snapshot â†’ archive â†’ new cycle) |
| `enforce_meal_cutoff()` | Trigger: blocks meal changes after cutoff (managers bypass) |
| `deduct_inventory_on_bazaar()` | Auto-updates inventory on bazaar entry |
| `update_bazaar_total()` | Auto-recalculates expense totals |

---

## ğŸ“Š Enum Types

```sql
user_role         â†’ 'manager' | 'member' | 'cook'
user_status       â†’ 'active' | 'inactive' | 'on_leave'
payment_method    â†’ 'cash' | 'bkash' | 'nagad' | 'bank_transfer' | 'other'
approval_status   â†’ 'pending' | 'approved' | 'rejected'
cycle_status      â†’ 'open' | 'closed' | 'archived'
fixed_cost_type   â†’ 'cook_salary' | 'wifi' | 'gas' | 'electricity' | 'water' | 'rent' | ...
```

---

## ğŸ¤ Contributing

Contributions are welcome! Feel free to:

1. ğŸ´ Fork the repo
2. ğŸŒ¿ Create a branch (`git checkout -b feature/amazing-feature`)
3. ğŸ’¾ Commit changes (`git commit -m 'Add amazing feature'`)
4. ğŸ“¤ Push (`git push origin feature/amazing-feature`)
5. ğŸ”ƒ Open a Pull Request

---

## ğŸ“ License

This project is open source under the **[MIT License](LICENSE)**.

---

<div align="center">

<img src="https://capsule-render.vercel.app/api?type=waving&color=0:FF6B6B,50:FFA94D,100:FFD43B&height=120&section=footer" width="100%" />

**Built with â¤ï¸ for mess-er à¦­à¦¾à¦‡à¦°à¦¾ everywhere.**

*"à¦®à§à¦¯à¦¾à¦¨à§‡à¦œà¦¾à¦° à¦¤à§à¦®à¦¿ à¦Ÿà¦¾à¦•à¦¾ à¦®à¦¾à¦°à¦›à§‹ â€” à¦à¦‡ à¦•à¦¥à¦¾ à¦¶à§à¦¨à¦¤à§‡ à¦¹à¦¬à§‡ à¦¨à¦¾ à¦†à¦°à¥¤"* ğŸ•

<br/>

<a href="https://kangal.software">
  <img src="https://img.shields.io/badge/Try_KANGAL_Now-FF6B6B?style=for-the-badge&logo=firefoxbrowser&logoColor=white" alt="Try KANGAL" />
</a>

</div>
